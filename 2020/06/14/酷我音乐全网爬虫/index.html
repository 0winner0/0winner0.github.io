<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>酷我音乐全网爬虫 | ZHANG JIN的个人博客</title><script src="https://cdn.bootcss.com/valine/1.4.4/Valine.min.js"></script><link rel="stylesheet" href="/css/arknights.css"><link rel="stylesheet" href="https://cdn.bootcss.com/highlight.js/9.18.1/styles/atom-one-dark-reasonable.min.css"><meta name="generator" content="Hexo 4.2.1"></head><body><header><nav><a href="/">Home</a><a href="/about">About</a><a href="/archives">Archives</a></nav></header><main><article><div id="post-bg"><div id="post-title"><div id="post-info"><span>date:<time datetime="2020-06-14T15:42:55.000Z" id="date"> 2020-06-14</time></span><br><span>updated:<time datetime="2020-06-14T15:45:44.884Z" id="updated"> 2020-06-14</time></span></div><h1>酷我音乐全网爬虫</h1><hr></div><div id="post-content"><h2 id="酷我音乐-http-www-kuwo-cn"><a href="#酷我音乐-http-www-kuwo-cn" class="headerlink" title="酷我音乐 http://www.kuwo.cn/"></a>酷我音乐 <a href="http://www.kuwo.cn/" target="_blank" rel="noopener">http://www.kuwo.cn/</a></h2><h3 id="1-分析音乐下载的接口"><a href="#1-分析音乐下载的接口" class="headerlink" title="1. 分析音乐下载的接口"></a>1. 分析音乐下载的接口</h3><p><a href="http://www.kuwo.cn/url?format=mp3&rid=81010978&response=url&type=convert_url3&br=128kmp3&from=web&t=1584003980221&reqId=xxxxxxxxxxxxxxxxxx" target="_blank" rel="noopener">http://www.kuwo.cn/url?format=mp3&amp;rid=81010978&amp;response=url&amp;type=convert_url3&amp;br=128kmp3&amp;from=web&amp;t=1584003980221&amp;reqId=xxxxxxxxxxxxxxxxxx</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python">&#123;<br>	<span class="hljs-string">"format"</span>: <span class="hljs-string">"mp3"</span>, <span class="hljs-comment"># 音频格式</span><br>	<span class="hljs-string">"rid"</span>: <span class="hljs-string">"81010978"</span>, <span class="hljs-comment"># 音乐的id</span><br>	<span class="hljs-string">"response"</span>: <span class="hljs-string">"url"</span>,<br>	<span class="hljs-string">"type"</span>: <span class="hljs-string">"convert_url3"</span>,<br>	<span class="hljs-string">"br"</span>: <span class="hljs-string">"128kmp3"</span>, <br>	<span class="hljs-string">"from"</span>: <span class="hljs-string">"web"</span>, <span class="hljs-comment"># 来源</span><br>	<span class="hljs-string">"t"</span>: <span class="hljs-string">"15840xxxxx60779"</span>, <span class="hljs-comment"># 时间戳</span><br>	<span class="hljs-string">"reqId"</span>: <span class="hljs-string">"xxxxxxxxxxxxxxxxxx"</span>, <span class="hljs-comment"># 请求id</span><br>&#125;<br></code></pre></td></tr></table></figure>

<p>经过测试剔除了一些参数 <a href="http://www.kuwo.cn/url?rid={}&amp;type=convert_url3&amp;br=128kmp3" target="_blank" rel="noopener">http://www.kuwo.cn/url?rid={}&amp;type=convert_url3&amp;br=128kmp3</a></p>
<p>下面这是响应的<code>json</code>数据</p>
<p><code>{&quot;code&quot;: 200, &quot;msg&quot;: &quot;success&quot;, &quot;url&quot;: &quot;https://sz-sycdn.kuwo.cn/96f635b8ea7045ffe7f1dec9baa4cf4d/5e6a0115/resource/n1/68/38/37304574.mp3&quot;}</code></p>
<p>请求返回了一个<code>json</code>数据，从这里我们可以看到，该<strong>音乐<code>id</code></strong>对应的请求的<code>url</code>，由于可以在新的标签页打开这个请求，可以看出这里的请求反爬几乎没有</p>
<h3 id="2-分析如何获取歌曲的rid值"><a href="#2-分析如何获取歌曲的rid值" class="headerlink" title="2. 分析如何获取歌曲的rid值"></a>2. 分析如何获取歌曲的<code>rid</code>值</h3><h4 id="2-1-根据关键字获取rid值"><a href="#2-1-根据关键字获取rid值" class="headerlink" title="2.1 根据关键字获取rid值"></a>2.1 根据关键字获取<code>rid</code>值</h4><p><a href="http://www.kuwo.cn/api/www/search/searchMusicBykeyWord?key=%E4%B8%80%E4%B8%AA%E4%BA%BA%E5%BE%88%E5%A5%BD&pn=1&rn=30&reqId=xxxxxxxxxxxxxxxxxx" target="_blank" rel="noopener">http://www.kuwo.cn/api/www/search/searchMusicBykeyWord?key=%E4%B8%80%E4%B8%AA%E4%BA%BA%E5%BE%88%E5%A5%BD&amp;pn=1&amp;rn=30&amp;reqId=xxxxxxxxxxxxxxxxxx</a></p>
<p>通过浏览器访问时，出现了<code>403 Forbidden</code>的响应，应该是做了一些反爬措施，经过测试，剔除了一些参数得到 <a href="http://www.kuwo.cn/api/www/search/searchMusicBykeyWord?key={}" target="_blank" rel="noopener">http://www.kuwo.cn/api/www/search/searchMusicBykeyWord?key={}</a></p>
<h4 id="2-2-通过获取音乐列表的接口获取rid值"><a href="#2-2-通过获取音乐列表的接口获取rid值" class="headerlink" title="2.2 通过获取音乐列表的接口获取rid值"></a>2.2 通过获取音乐列表的接口获取<code>rid</code>值</h4><p><a href="http://www.kuwo.cn/api/www/bang/bang/musicList?bangId=93&pn=1&rn=30&reqId=xxxxxxxxxxxxxxxxxx" target="_blank" rel="noopener">http://www.kuwo.cn/api/www/bang/bang/musicList?bangId=93&amp;pn=1&amp;rn=30&amp;reqId=xxxxxxxxxxxxxxxxxx</a></p>
<p>这个接口需要<code>cookie</code>头和<code>csrf</code>头，从浏览器copy一下就可以了（应该是比较<code>cookie</code>里面的<code>csrf</code>值和<code>csrf</code>头里面的值是否相同）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python">&#123;<br>	<span class="hljs-string">"bangId"</span>: <span class="hljs-string">"93"</span>, <span class="hljs-comment"># 酷我飙升榜</span><br>	<span class="hljs-string">"pn"</span>: <span class="hljs-string">"1"</span>, <span class="hljs-comment"># 页数</span><br>	<span class="hljs-string">"rn"</span>: <span class="hljs-string">"30"</span>, <span class="hljs-comment"># 一页的歌曲数</span><br>	<span class="hljs-string">"reqId"</span>: <span class="hljs-string">"xxxxxxxxxxxxxxxxxx"</span>, <span class="hljs-comment"># 请求的id</span><br>&#125;<br></code></pre></td></tr></table></figure>

<p>由于获取音乐列表是通过<code>bangid</code>获取，所以要找到获取<code>bangid</code>的接口</p>
<h4 id="2-3-获取所有的音乐排行榜的接口"><a href="#2-3-获取所有的音乐排行榜的接口" class="headerlink" title="2.3 获取所有的音乐排行榜的接口"></a>2.3 获取所有的音乐排行榜的接口</h4><p><a href="http://www.kuwo.cn/api/www/bang/bang/bangMenu" target="_blank" rel="noopener">http://www.kuwo.cn/api/www/bang/bang/bangMenu </a> 找到这个接口有点巧合</p>
<p>这个接口里面的<code>sourceid</code>就对应了<code>bangid</code>值</p>
<p>这个接口需要<code>cookie</code>头和<code>csrf</code>头，从浏览器copy一下就可以了（应该是比较<code>cookie</code>里面的<code>csrf</code>值和<code>csrf</code>头里面的值是否相同），就是处理一下<code>csrf</code>，<strong>直接访问会出现</strong><code>{&quot;success&quot;:false,&quot;message&quot;:&quot;CSRF Token Not Found!&quot;,&quot;now&quot;:&quot;2020-03-xxx:00:xxx&quot;}</code></p>
<p>来一张图</p>
<img src="/2020/06/14/%E9%85%B7%E6%88%91%E9%9F%B3%E4%B9%90%E5%85%A8%E7%BD%91%E7%88%AC%E8%99%AB/bang_menu.png" alt="音乐榜单信息" style="zoom: 80%;">

<p>从这里，我们可以算一下，如果每一个<strong>子榜单</strong>下载前<strong>30首歌</strong>那么一会下载的歌曲数目为：</p>
<ul>
<li>子榜单数目: <code>5 + 13 + 6 + 5 + 9 + 2 = 40</code></li>
<li>歌曲总数: <code>40 * 30 = 1200</code></li>
<li>每首歌曲的大小大约为: <code>4M</code></li>
<li>整个下下来的数据的大小为: <code>4800M = 4800/1024~= 4.69G</code></li>
</ul>
<h3 id="3-一些其他的接口"><a href="#3-一些其他的接口" class="headerlink" title="3. 一些其他的接口"></a>3. 一些其他的接口</h3><h4 id="3-1-根据音乐mid值获取音乐信息"><a href="#3-1-根据音乐mid值获取音乐信息" class="headerlink" title="3.1 根据音乐mid值获取音乐信息"></a>3.1 根据音乐<code>mid</code>值获取音乐信息</h4><p><a href="http://www.kuwo.cn/api/www/music/musicInfo?mid=81010978&reqId=xxxxxxxxxxxxxxxxxx" target="_blank" rel="noopener">http://www.kuwo.cn/api/www/music/musicInfo?mid=81010978&amp;reqId=xxxxxxxxxxxxxxxxxx</a></p>
<p>这个接口需要剔除的参数很少，就一个<code>reqid</code>应该是标识的身份信息</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python">&#123;<br>	<span class="hljs-string">"mid"</span>: <span class="hljs-string">"81010978"</span>, <span class="hljs-comment"># 音乐的mid值 和 rid 相同</span><br>	<span class="hljs-string">"reqId"</span>: <span class="hljs-string">"xxxxxxxxxxxxxxxxxx"</span>, <span class="hljs-comment"># 请求的id</span><br>&#125;<br></code></pre></td></tr></table></figure>

<p>这个接口需要<code>cookie</code>头和<code>csrf</code>头，从浏览器copy一下就可以了（应该是比较<code>cookie</code>里面的<code>csrf</code>值和<code>csrf</code>头里面的值是否相同）</p>
<h4 id="3-2-获取歌词的接口"><a href="#3-2-获取歌词的接口" class="headerlink" title="3.2 获取歌词的接口"></a>3.2 获取歌词的接口</h4><p><a href="http://m.kuwo.cn/newh5/singles/songinfoandlrc?musicId=80488731&reqId=xxxxxxxxxxxxxxxxxx" target="_blank" rel="noopener">http://m.kuwo.cn/newh5/singles/songinfoandlrc?musicId=80488731&amp;reqId=xxxxxxxxxxxxxxxxxx</a></p>
<p>这个接口新建一个标签就可以访问了。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs json">&#123;<span class="hljs-attr">"data"</span>:&#123;<span class="hljs-attr">"lrclist"</span>:[&#123;<span class="hljs-attr">"time"</span>:<span class="hljs-string">"0.0"</span>,<span class="hljs-attr">"lineLyric"</span>:<span class="hljs-string">"《你的答案》"</span>&#125;,&#123;<span class="hljs-attr">"time"</span>:<span class="hljs-string">"2.46"</span>,<span class="hljs-attr">"lineLyric"</span>:<span class="hljs-string">"作词 Lyrics：林晨阳 刘涛"</span>&#125;,&#123;<span class="hljs-attr">"time"</span>:<span class="hljs-string">"4.69"</span>,<span class="hljs-attr">"lineLyric"</span>:<span class="hljs-string">"作曲 Music：刘涛"</span>&#125;,&#123;<span class="hljs-attr">"time"</span>:<span class="hljs-string">"7.34"</span>,<span class="hljs-attr">"lineLyric"</span>:<span class="hljs-string">"演唱Singer：阿冗"</span>&#125;,&#123;<span class="hljs-attr">"time"</span>:<span class="hljs-string">"9.32"</span>,<span class="hljs-attr">"lineLyric"</span>:<span class="hljs-string">"制作人 Produced by 刘涛"</span>&#125;,&#123;<span class="hljs-attr">"time"</span>:<span class="hljs-string">"12.09"</span>,<span class="hljs-attr">"lineLyric"</span>:<span class="hljs-string">"编曲 Arranger：谭侃侃"</span>&#125;,&#123;<span class="hljs-attr">"time"</span>:<span class="hljs-string">"14.6"</span>,<span class="hljs-attr">"lineLyric"</span>:<span class="hljs-string">"吉他 Guitar：谭侃侃"</span>&#125;,&#123;<span class="hljs-attr">"time"</span>:<span class="hljs-string">"15.15"</span>,<span class="hljs-attr">"lineLyric"</span>:<span class="hljs-string">"键盘 Keyboards：谭侃侃"</span>&#125;,&#123;<span class="hljs-attr">"time"</span>:<span class="hljs-string">"17.44"</span>,<span class="hljs-attr">"lineLyric"</span>:<span class="hljs-string">"合声 Backing vocals：金天 胡阁"</span>&#125;,&#123;<span class="hljs-attr">"time"</span>:<span class="hljs-string">"18.95"</span>,<span class="hljs-attr">"lineLyric"</span>:<span class="hljs-string">"录音棚 Recording studio：北京好乐无荒录音棚"</span>&#125;,&#123;<span class="hljs-attr">"time"</span>:<span class="hljs-string">"19.65"</span>,<span class="hljs-attr">"lineLyric"</span>:<span class="hljs-string">"录音师 Recording Engineer：吴佳敏"</span>&#125;,&#123;<span class="hljs-attr">"time"</span>:<span class="hljs-string">"20.35"</span>,<span class="hljs-attr">"lineLyric"</span>:<span class="hljs-string">"混音师 Mixing Engineer：刘三斤"</span>&#125;,&#123;<span class="hljs-attr">"time"</span>:<span class="hljs-string">"21.59"</span>,<span class="hljs-attr">"lineLyric"</span>:<span class="hljs-string">"母带后期混音师 Mastering Engineer：刘三斤"</span>&#125;,&#123;<span class="hljs-attr">"time"</span>:<span class="hljs-string">"22.2"</span>,<span class="hljs-attr">"lineLyric"</span>:<span class="hljs-string">"监制 Executive producer: 陶诗"</span>&#125;,&#123;<span class="hljs-attr">"time"</span>:<span class="hljs-string">"23.0"</span>,<span class="hljs-attr">"lineLyric"</span>:<span class="hljs-string">"OP/SP：好乐无荒"</span>&#125;,&#123;<span class="hljs-attr">"time"</span>:<span class="hljs-string">"24.0"</span>,<span class="hljs-attr">"lineLyric"</span>:<span class="hljs-string">"封面设计：kidult."</span>&#125;,&#123;<span class="hljs-attr">"time"</span>:<span class="hljs-string">"24.82"</span>,<span class="hljs-attr">"lineLyric"</span>:<span class="hljs-string">"鸣谢：万物体验家；不要音乐"</span>&#125;,&#123;<span class="hljs-attr">"time"</span>:<span class="hljs-string">"25.24"</span>,<span class="hljs-attr">"lineLyric"</span>:<span class="hljs-string">"也许世界就这样"</span>&#125;,&#123;<span class="hljs-attr">"time"</span>:<span class="hljs-string">"28.49"</span>,<span class="hljs-attr">"lineLyric"</span>:<span class="hljs-string">"我也还在路上"</span>&#125;,&#123;<span class="hljs-attr">"time"</span>:<span class="hljs-string">"31.13"</span>,<span class="hljs-attr">"lineLyric"</span>:<span class="hljs-string">"没有人能诉说"</span>&#125;,&#123;<span class="hljs-attr">"time"</span>:<span class="hljs-string">"36.21"</span>,<span class="hljs-attr">"lineLyric"</span>:<span class="hljs-string">"也许我只能沉默"</span>&#125;,&#123;<span class="hljs-attr">"time"</span>:<span class="hljs-string">"39.25"</span>,<span class="hljs-attr">"lineLyric"</span>:<span class="hljs-string">"眼泪湿润眼眶"</span>&#125;,&#123;<span class="hljs-attr">"time"</span>:<span class="hljs-string">"42.1"</span>,<span class="hljs-attr">"lineLyric"</span>:<span class="hljs-string">"可又不甘懦弱"</span>&#125;,...<br></code></pre></td></tr></table></figure><div id="paginator"></div></div><div id="post-footer"><hr><a href="/2020/06/10/bilibili%E8%A7%86%E9%A2%91%E7%88%AC%E8%99%AB/">bilibili视频爬虫 Next →</a><hr></div><div id="bottom-btn"><a id="to-index" href="#post-index" title="index">≡</a><a id="to-top" href="#post-title" title="to top">∧</a></div><details id="reward"><summary>打赏</summary><div id="alipay"><span>支付宝 | Alipay</span><br><img src="/img/Alipay.png"></div><div id="wechat"><span>微信 | WeChat</span><br><img src="/img/WeChat.png"></div></details><div id="Valine"></div><script>new Valine({
 el: '#Valine'
 , appId: ''
 , appKey: ''
 , placeholder: '此条评论委托企鹅物流发送'
})</script></div></article><aside><div id="about"><a href="/" id="logo"><img src="https://ak.hypergryph.com/assets/index/images/ak/pc/faction/1.png" alt="Logo"></a><h1 id="Dr"><a href="/"> Dr.DAJINZI01</a></h1><section id="total"><a id="total-archives" href="/archives"><span class="total-title">Archives Total:</span><span class="total-number">4</span></a><div id="total-tags"><span class="total-title">Tags:</span><span class="total-number">3</span></div><div id="total-categories"><span class="total-title">Categories:</span><span class="total-number">2</span></div></section></div><div id="aside-block"><h1>INDEX</h1><div id="post-index"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#酷我音乐-http-www-kuwo-cn"><span class="toc-number">1.</span> <span class="toc-text">酷我音乐 http:&#x2F;&#x2F;www.kuwo.cn&#x2F;</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-分析音乐下载的接口"><span class="toc-number">1.1.</span> <span class="toc-text">1. 分析音乐下载的接口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-分析如何获取歌曲的rid值"><span class="toc-number">1.2.</span> <span class="toc-text">2. 分析如何获取歌曲的rid值</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-根据关键字获取rid值"><span class="toc-number">1.2.1.</span> <span class="toc-text">2.1 根据关键字获取rid值</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-通过获取音乐列表的接口获取rid值"><span class="toc-number">1.2.2.</span> <span class="toc-text">2.2 通过获取音乐列表的接口获取rid值</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-获取所有的音乐排行榜的接口"><span class="toc-number">1.2.3.</span> <span class="toc-text">2.3 获取所有的音乐排行榜的接口</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-一些其他的接口"><span class="toc-number">1.3.</span> <span class="toc-text">3. 一些其他的接口</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-根据音乐mid值获取音乐信息"><span class="toc-number">1.3.1.</span> <span class="toc-text">3.1 根据音乐mid值获取音乐信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-获取歌词的接口"><span class="toc-number">1.3.2.</span> <span class="toc-text">3.2 获取歌词的接口</span></a></li></ol></li></ol></li></ol></div></div><footer><nobr><span class="text-title">©</span><span class="text-content">1970 to 2020</span></nobr><wbr><nobr><span class="text-title">ICP</span><span class="text-content">——备案号——</span></nobr><wbr><wbr><nobr>published with&nbsp;<a href="http://hexo.io" target="_blank" rel="noopener">Hexo&nbsp;</a></nobr><wbr><nobr>Theme&nbsp;<a href="https://github.com/Yue-plus/hexo-theme-arknights" target="_blank" rel="noopener">Arknight&nbsp;</a></nobr><wbr><nobr>by&nbsp;<a href="https://github.com/Yue-plus" target="_blank" rel="noopener">Yue_plus</a></nobr></footer></aside></main><canvas id="canvas-dust"></canvas><script src="/js/arknights.js"></script></body></html>